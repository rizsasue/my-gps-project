<!DOCTYPE html>
<html>
<head>
    <title>Visualisasi Data GPS di Peta</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFf0iGjJdWxg2Tvth6WP9bwzaS2SK9J2c"></script>
    <style>
        body {
            margin: 0; /* Menghilangkan margin default */
        }
        #map {
            height: calc(100vh - 120px); /* Tinggi peta dikurangi tinggi kotak teks */
            width: 100%; /* Full width */
        }
        #infoBox {
            height: 120px; /* Tinggi kotak */
            width: 100%; /* Full width */
            background-color: rgba(255, 255, 255, 0.9); /* Warna latar belakang dengan transparansi */
            display: flex; /* Menggunakan flexbox untuk penataan konten */
            align-items: center; /* Mengatur konten secara vertikal */
            justify-content: center; /* Mengatur konten secara horizontal */
            font-size: 24px; /* Ukuran font */
            color: black; /* Warna teks */
            position: absolute; /* Memposisikan kotak di atas peta */
            top: 0; /* Posisi atas */
            left: 0; /* Posisi kiri */
            z-index: 1; /* Mengatur urutan z agar di atas peta */
        }
        #errorMessage {
            color: red;
            font-size: 24px;
            display: none; /* Sembunyikan pesan secara default */
        }
    </style>
</head>
<body>
    <div id="infoBox">Lat: -, Lng: -</div> <!-- Kotak teks untuk menunjukkan posisi -->
    <div id="map"></div>
    <div id="errorMessage">Tidak ada data lokasi yang tersedia.</div>

    <script>
        let map;
        let currentMarker; // Untuk menyimpan marker saat ini

        function initMap() {
            // Inisialisasi peta
            const defaultLocation = { lat: -8.559320, lng: 115.105210 }; 
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: defaultLocation,
            });

            // Ambil data dari ThingSpeak
            fetch('https://api.thingspeak.com/channels/2770137/feeds.json?api_key=JB2MT0HP4G3BF9LS&results=1') // Mengambil hasil terbaru
                .then(response => response.json())
                .then(data => {
                    const feeds = data.feeds;

                    if (feeds.length === 0) {
                        document.getElementById('errorMessage').style.display = 'block';
                        return;
                    }

                    // Ambil data terakhir
                    const lastFeed = feeds[feeds.length - 1];
                    const lat = parseFloat(lastFeed.field1);
                    const lng = parseFloat(lastFeed.field2);

                    // Hapus marker sebelumnya jika ada
                    if (currentMarker) {
                        currentMarker.setMap(null);
                    }

                    // Update isi infoBox dengan posisi terbaru
                    document.getElementById('infoBox').innerText = `Lat: ${lat}, Lng: ${lng}`;

                    // Tambahkan marker dengan lokasi terbaru
                    currentMarker = new google.maps.Marker({
                        position: { lat, lng },
                        map: map,
                        title: `Lat: ${lat}, Lng: ${lng}`
                    });
                })
                .catch(error => {
                    console.error("Error fetching data from ThingSpeak:", error);
                    document.getElementById('errorMessage').style.display = 'block';
                });
        }

        window.onload = initMap; // Inisialisasi peta saat jendela dimuat
    </script>
</body>
</html>
